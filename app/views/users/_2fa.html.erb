<% if !user %>
  <%= link_to "Sign up", new_user_registration_path %>
  <%= link_to "Login", new_user_session_path %>
<% end %>

<% if user %>
  <% if !user.admin_allow_tfa %>
    <%= button_to "Enable 2FA for this User", users_allow_tfa_path(user_id: user.id), :method => :post %>
  <% end %>

  <% if user.admin_allow_tfa %>
    <%= button_to "Disable 2FA", users_deny_tfa_path(user_id: user.id), :method => :post %>
    <div class="container" style="width: 194pt;">

      <%
        require 'rqrcode'

        qrcontent=user.otp_provisioning_uri(user.email, issuer: "Project Tu-FA")

        qrcode = RQRCode::QRCode.new(qrcontent)
        qrsize = 135

        svg = qrcode.as_svg(
        offset: 0,
        color: '000',
        shape_rendering: 'crispEdges',
        module_size: 6,
        standalone: true
        )

        image64_svg = Base64.encode64(svg)
        image_source_svg="data:image/svg+xml;charset=utf-8;base64,#{image64_svg}"
      %>

      <img src="<%= image_source_svg %>" width="<%= qrsize %>" height="<%= qrsize %>" alt="WhatEver">

    </div>

    <br>

  <% end %>
  <%= link_to "Log out", destroy_user_session_path, :method => :delete %>
<% end %>
